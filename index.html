<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kresl√≠tko</title>
    <link rel="stylesheet" type="text/css" href="styles/reset.css">
    <link rel="stylesheet" type="text/css" href="styles/styles.css">
    <link rel="stylesheet" href="libs/font-awesome-4.6.3/css/font-awesome.min.css">


    <script type="application/javascript" src="src/Enums.js"></script>

    <!-- model -->
    <script type="application/javascript" src="src/model/Entity.js"></script>
    <script type="application/javascript" src="src/model/Attribute.js"></script>
    <script type="application/javascript" src="src/model/AttributeList.js"></script>
    <script type="application/javascript" src="src/model/Relation.js"></script>
    <script type="application/javascript" src="src/model/RelationLeg.js"></script>

    <!-- view -->
    <script type="application/javascript" src="src/view/EditableText.js"></script>
    <script type="application/javascript" src="src/view/Entity.js"></script>
    <script type="application/javascript" src="src/view/Attribute.js"></script>
    <script type="application/javascript" src="src/view/Relation.js"></script>
    <script type="application/javascript" src="src/view/RelationLeg.js"></script>

    <!-- control -->
    <script type="application/javascript" src="src/control/Entity.js"></script>
    <script type="application/javascript" src="src/control/Attribute.js"></script>
    <script type="application/javascript" src="src/control/AttributeList.js"></script>
    <script type="application/javascript" src="src/control/Relation.js"></script>
    <script type="application/javascript" src="src/control/RelationLeg.js"></script>

    <script type="application/javascript" src="src/Random.js"></script>
    <script type="application/javascript" src="src/Canvas.js"></script>
    <script type="application/javascript" src="src/Layout.js"></script>
    <script type="application/javascript" src="src/Mouse.js"></script>
    <script type="application/javascript" src="src/Element.js"></script>
    <script type="application/javascript" src="src/Geometry.js"></script>
    <script type="application/javascript" src="src/Vector.js"></script>

    <script type="application/javascript" src="src/MenuController.js"></script>

    <!--
        <script type="application/javascript" src="src/Entity.js"></script>
        <script type="application/javascript" src="src/EditableText.js"></script>
        <script type="application/javascript" src="src/Attribute.js"></script>
        <script type="application/javascript" src="src/RelationControl.js"></script>
        <script type="application/javascript" src="src/RelationLeg.js"></script>
        -->
</head>
<body>

    <a href="javascript:toString();void(0);">to string</a>
    <a href="javascript:clear();void(0);">clear</a>

    <a href="javascript:saveEntityModels();void(0);">save</a>
    <a href="javascript:redrawEntities();void(0);">redraw</a>
    <a href="javascript:sort();void(0);">sort</a>
    <script>

        DBSDM.Menu.build();

        var canvas = new DBSDM.Canvas();
        canvas.create();

        function toString() {
            for (var i=0; i <canvas._entities.length; i++) {
                console.log(canvas._entities[i]._model.toString());
            }
        }

        function clear() {
            canvas.clear();
        }

        var entities = [];
        var relations = [];
        function saveEntityModels() {
            entities = [];
            var i;
            for (i=0; i <canvas._entities.length; i++) {
                entities.push(canvas._entities[i]._model);
            }
            console.log(entities);

            relations = [];
            for (i=0; i <canvas._relations.length; i++) {
                relations.push(canvas._relations[i]._model);
            }
        }

        function redrawEntities() {
            var e1 = new DBSDM.Model.Entity("Entity_1");
            var e1atr = e1.getAttributeList();
            e1atr.add(new DBSDM.Model.Attribute("Attribute_1"));

            e1.setPosition(100, 150);
            e1.setSize(50, 80);

            var e2 = new DBSDM.Model.Entity("Entity_2");
            e2.setPosition(300, 125);
            e2.setSize(70, 50);

            var source = new DBSDM.Model.RelationLeg(true, true, DBSDM.Enums.Cardinality.MANY);
            source.setEntity(e1);
            source.setAnchorOffset(11);
            source.setAnchor(150, 170, DBSDM.Enums.Edge.RIGHT);

            var target = new DBSDM.Model.RelationLeg(false, false, DBSDM.Enums.Cardinality.ONE);
            target.setEntity(e2);
            target.setAnchorOffset(11);
            target.setAnchor(300, 170, DBSDM.Enums.Edge.LEFT);

            var r1 = new DBSDM.Model.Relation(source, target);
            r1.straighten();

            //source.addPoint(1, {x: 170, y: 200});

            canvas.import([e1, e2], [r1]);
        }


        function sort() {
            canvas.sort();
        }

    </script>

</body>
</html>